@use 'sass:map';
@use 'sass:color';
@use '../../style/theming';

// MARK: Variables
$icon-spacing: 6px;
$hint-opacity: 0.8;
$note-opacity: 0.7;
$mat-hint-opacity: 0.54; // Opacity to mirror mat-hint
$dbx-label-padded-padding: 6px;

// MARK: Mixin
@mixin core() {
  .dbx-small,
  .dbx-clear-hint {
    font-size: 0.8em;
  }

  .dbx-label-padded {
    padding-bottom: $dbx-label-padded-padding;
  }

  .text-center,
  .dbx-text-center {
    text-align: center;
  }

  .dbx-json,
  .prettyjson {
    white-space: pre-wrap !important;
  }

  .dbx-label-block {
    display: block;
    padding: 3px 0;
  }

  .dbx-text-no-overflow {
    white-space: pre-wrap !important;
    overflow: visible !important;
    text-overflow: unset !important;
  }

  .dbx-icon-spacer {
    margin-right: $icon-spacing;
  }

  .dbx-form-description {
    font-size: 75%;
    margin-top: 0.6666666667em;
  }

  .dbx-chip {
    font-size: 14px;
    font-weight: 500;
    position: relative;
    box-sizing: border-box;
  }

  .dbx-chip.dbx-chip-small {
    font-size: 12px;
    padding: 2px 8px;
    min-height: 20px;
  }

  .dbx-chip.dbx-chip-block {
    border-radius: 0;
  }

  .dbx-chip-margin {
    margin: 4px;
  }
}

@mixin color($theme-config) {
  $color-config: theming.get-color-config($theme-config);
  $accent: map.get($color-config, 'accent');
  $warn: map.get($color-config, 'warn');
  $background: map.get($color-config, 'background');
  $foreground: map.get($color-config, 'foreground');

  $text-color: theming.get-color-from-palette($foreground, 'text');
  $border-color: theming.get-color-from-palette($background, 'background');
  $outlined-text-color: transparentize($border-color, 0.6);

  $is-dark: map.get($theme-config, is-dark);

  @if $is-dark == true {
    $text-color: darken($text-color, 35);
    $outlined-text-color: $border-color;
  }

  $ok-color: color.scale(blue, $lightness: 30%);
  $success-color: green;
  $notice-color: #f28600;

  .dbx-hint,
  .dbx-clear-hint {
    opacity: $hint-opacity;
  }

  .dbx-success {
    color: $success-color;
  }

  .dbx-ok {
    color: $ok-color;
  }

  .dbx-label,
  .dbx-sublabel,
  .dbx-chip-sublabel,
  .dbx-form-description {
    opacity: $mat-hint-opacity;
  }

  .dbx-notice {
    font-weight: bold;
    color: $notice-color;
  }

  .dbx-note {
    opacity: $note-opacity;
  }

  .dbx-outlined-text {
    color: $text-color;
    text-shadow: -1px -1px 0 $outlined-text-color, 1px -1px 0 $outlined-text-color, -1px 1px 0 $outlined-text-color, 1px 1px 0 $outlined-text-color;
  }
}

@mixin typography($typography-config) {
  .dbx-label,
  .dbx-sublabel,
  .dbx-chip-sublabel {
    font-size: theming.font-size($typography-config, 'caption');
  }

  .dbx-chip-sublabel {
    margin-left: $icon-spacing;
  }
}

@mixin theme($theme-config) {
  @include theming.private-check-duplicate-theme-styles($theme-config, 'dbx-text') {
    $color: theming.get-color-config($theme-config);
    $typography: theming.get-typography-config($theme-config);

    @if $color !=null {
      @include color($theme-config);
    }

    @if $typography !=null {
      @include typography($typography);
    }
  }
}
