<div class="dbx-from-target-summary-field">
  <!-- Autocomplete Template -->
  <mat-autocomplete #auto="matAutocomplete" [autoActiveFirstOption]="true" [displayWith]="displayWith"
    (optionSelected)="selected($event)" (closed)="autoCompleteClosed()">
    <mat-option *ngFor="let summary of filteredValues$ | async" [value]="summary">
      <div fxLayout="row">
        <div>{{ summary.connectedEmail }}</div>
        <!--
        <div *ngIf="summary.correspondence">
          <small>Last email correspondence from {{ primaryTargetEmail$ | async }} on
            {{ summary.correspondence.lastEmailInteractionAt | toJsDate | date:'medium' }}.</small>
        </div>
        -->
      </div>
    </mat-option>
  </mat-autocomplete>
  <!-- Template -->
  <ng-template #content>
    <mat-form-field class="dbx-from-target-summary-field-form-field">
      <mat-label>{{ label }}</mat-label>
      <input #emailInput #trigger="matAutocompleteTrigger" matInput [required]="required" [placeholder]="placeholder"
        [formControl]="inputCtrl" [matAutocomplete]="auto" (keydown)="tabPressedOnInput($event)"
        [formlyAttributes]="field">
    </mat-form-field>
  </ng-template>
  <!-- View -->
  <ng-container [ngSwitch]="showEditor$ | async">
    <ng-container *ngSwitchCase="true">
      <ng-container *ngTemplateOutlet="content"></ng-container>
    </ng-container>
    <ng-container *ngSwitchCase="false">
      <span (click)="changeEmail()">
        <span class="dbx-label">From&nbsp;<span *ngIf="required">*</span></span>
        <dbx-button-spacer></dbx-button-spacer>
        <dbx-button [disabled]="disabled" [working]="isLoadingValues$ | async" icon="expand_more"
          [text]="(selectedValueEmail$ | async) || label">
        </dbx-button>
      </span>
    </ng-container>
  </ng-container>
  <!-- Hint -->
  <dbx-hint *ngIf="isLockedToUser$ | async"><small>This email is a reply. You can only reply to an email with the same
      email address it was sent to.</small></dbx-hint>
</div>
