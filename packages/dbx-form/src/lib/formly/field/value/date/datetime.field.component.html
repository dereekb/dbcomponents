<div class="dbx-datetime-field" fxLayout="row wrap" fxLayout.xs="column wrap" fxLayoutAlign="space-evenly stretch">
  <!-- Date -->
  <div class="dbx-datetime-row" fxFlex.lt-sm="100" [fxFlex]="dateOnly ? '100' : '50'" *ngIf="showDateInput">
    <ng-container *ngTemplateOutlet="dateInputTemplate"></ng-container>
  </div>
  <!-- Time -->
  <div class="dbx-datetime-row" fxFlex.lt-sm="100" [fxFlex]="showDateInput ? '50' : '100'">
    <ng-container *ngIf="showTimeInput$ | async">
      <ng-container *ngTemplateOutlet="timeMenuAndInputTemplate"></ng-container>
    </ng-container>
    <div class="add-time-button-wrapper" *ngIf="showAddTime$ | async">
      <button mat-button class="add-time-button" ngClass.lt-sm="add-time-button-full" (click)="addTime()">
        <mat-icon>timer</mat-icon> Add Time
      </button>
    </div>
  </div>
  <div class="dbx-datetime-row dbx-datetime-hint-row" fxFlex="100">
    <div class="dbx-hint" [ngSwitch]="fullDay$ | async">
      <small *ngSwitchCase="true"><b class="dbx-ok">All Day</b> {{ dateValue$ | async | date:'fullDate' }}
        ({{ dateValue$ | async | dateDistance }})</small>
      <small *ngSwitchCase="false">
        <ng-container *ngIf="value$ | async"><b class="dbx-ok">At</b> {{ displayValue$ | async | date:'medium' }}
          ({{ displayValue$ | async | timeDistance }})</ng-container>
      </small>
    </div>
  </div>
</div>

<!-- Date Input Template -->
<ng-template #dateInputTemplate>
  <button mat-icon-button (click)="picker.open()" [disabled]="disabled">
    <mat-icon>calendar_today</mat-icon>
  </button>
  <mat-form-field class="dbx-datetime-row-field">
    <mat-label>Date</mat-label>
    <input #dateInput matInput [formControl]="dateInputCtrl" [matDatepicker]="picker" (dateChange)="datePicked($event)"
      [value]="dateValue$ | async">
    <mat-datepicker #picker></mat-datepicker>
  </mat-form-field>
</ng-template>

<!-- Time Menu/Input Template -->
<ng-template #timeMenuAndInputTemplate>
  <button mat-icon-button [matMenuTriggerFor]="timemenu" aria-label="opens the time menu" [disabled]="disabled">
    <mat-icon>timer</mat-icon>
  </button>
  <mat-menu #timemenu="matMenu">
    <ng-container *ngIf="timeMode === 'optional'">
      <button mat-menu-item (click)="removeTime()">
        <span>Remove Time</span>
      </button>
      <mat-divider></mat-divider>
    </ng-container>
    <button mat-menu-item (click)="setLogicalTime('now')">
      <span>Now</span>
    </button>
    <button mat-menu-item (click)="setTime('12:00AM')">
      <span>Midnight</span>
    </button>
    <button mat-menu-item (click)="setTime('6:00AM')">
      <span>6:00AM</span>
    </button>
    <button mat-menu-item (click)="setTime('8:00AM')">
      <span>8:00AM</span>
    </button>
    <button mat-menu-item (click)="setTime('10:00AM')">
      <span>10:00AM</span>
    </button>
    <button mat-menu-item (click)="setTime('12:00PM')">
      <span>Noon</span>
    </button>
    <button mat-menu-item (click)="setTime('2:00PM')">
      <span>2:00PM</span>
    </button>
    <button mat-menu-item (click)="setTime('5:00PM')">
      <span>5:00PM</span>
    </button>
  </mat-menu>
  <mat-form-field class="dbx-datetime-row-field">
    <mat-label>Time</mat-label>
    <input #timeInput matInput [formControl]="timeInputCtrl" (focus)="focusTime()" (focusout)="focusOutTime()"
      (keydown)="keydownOnInput($event)">
  </mat-form-field>
</ng-template>
